<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta charset="UTF-8">
    <meta http-equiv="x-ua-compatible" content="IE=9;IE=10;IE=11;IE=edge" />
    <title>中转</title>
    <link href="../../static/image/sprite/i_logoico1.ico" rel="shortcut icon">
    <script src="../../static/plugin/jquery-1.11.3.min.js"></script>
</head>
<body>
<script>
    function UrlSearch() {
        var name, value;
        var str = window.location.search; //取得整个地址栏参数
        var num = str.indexOf("?");
        str = str.substr(num + 1); //取得所有参数   stringvar.substr(start [, length ]
        var arr = str.split("&"); //各个参数放到数组里
        for (var i = 0; i < arr.length; i++) {
            num = arr[i].indexOf("=");
            if (num > 0) {
                name = arr[i].substring(0, num);
                value = arr[i].substr(num + 1);
                this[name] = value;
            }
        }
    }
    var Request = new UrlSearch(); //实例化
    //存入cookie
    function SetCookie(key, value, day) {
        var dat = new Date();
        dat.setDate(dat.getDate() + day);
        document.cookie = key + '=' + escape(value) + ';expires=' + dat + ';path=/';
    }
//    $(window).unload(function () {
//        removeCookie('backPreviewToken')
//    });
    function removeCookie(key) {
        SetCookie(key, "0", -1);
    }
    function GetCookie(name)
    {
        var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");
        if(arr=document.cookie.match(reg))
            return unescape(arr[2]);
        else
            return null;
    }
    if(Request.backPreviewToken=='baichuantushu'){
        var JsonStr={
            "name": "whdxAdmin",
            "userType": "1",
            "user": {
                "subjectId": Request.subjectId,
                "materialId": Request.materialId
            }
        };
        var IsCookieStr = JSON.stringify(JsonStr);
        console.log(IsCookieStr)
        SetCookie('backPreviewToken',IsCookieStr,1);
        if(GetCookie('backPreviewToken')!=''){
            var ThisUrl=window.location.href;
            window.location.href=ThisUrl.split('?Url=')[1];
        }
    }
</script>
</body>
</html>